<!DOCTYPE html>
<html lang="zh-CN"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="fragments/adminModel">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script type="text/javascript" src="/js-lib/bootstrap-treeview.min.js"></script>
    <script type="text/javascript" src="/js-lib/ui/jquery.ui.core.js"></script>
    <script type="text/javascript" src="/js-lib/ui/jquery.ui.widget.js"></script>
    <script type="text/javascript" src="/js-lib/ui/jquery.ui.mouse.js"></script>
    <script type="text/javascript" src="/js-lib/ui/jquery.ui.sortable.js"></script>

    <script type="text/javascript" src="/admin/myself/my.sortable.js"></script>

    <title>菜单列表</title>
    <script type="text/javascript">
        $(function() {
            $(".rebuildMenu").deleteFun({title:'重构提示', msg:'确定要重新生成所有菜单吗？请谨慎操作'});

            var defaultData = $("#treeJson").val();
            //alert(defaultData);
            defaultData = eval('(' + defaultData + ')'); //JSON.parse(defaultData);

            //alert(defaultData);
            var myMenuTree = $('#tree1').treeview({
                data: defaultData,
                showIcon: true,
                showCheckbox: false,
                showTags: true,
                state:'',
                multiSelect: false,
                //levels: 99, //展开99级，基本也就是全部展开了
                onNodeSelected: function(event, node) {
                    operate(node.text, "1");
                }
            });

            myMenuTree.treeview("checkNode", myMenuTree.treeview("search", "="+$("#curPid").val()+">"));

            //添加或删除数据
            function operate(name, flag) {
                var objId = $(name).attr("title"); //获取菜单Id
                //alert(objId);
                if(objId!=$("#curPid").val()) {
                    window.location.href = $("#thisUrl").val()+objId;
                }
            }

            $("table").sorttable({
                url:"/admin/menu/updateSort",
                authSn:"MenuController.updateSort"
            });
        });
    </script>
</head>
<body>

<input type="hidden" id="thisUrl" value="/admin/menu/list?pid="/>
<input type="hidden" id="treeJson" th:value="${treeJson}"/>
<input type="hidden" id="curPid" th:value="${param.pid}"/>
<div class="header lighter smaller blue">
    <h3><span class="glyphicon glyphicon-th-list"></span>&nbsp;菜单列表<small>（）</small></h3>
    <div th:replace="./nav :: content" th:remove="tag"></div>
</div>

<!-- <div class="table-header">
    Results for "Latest Registered Domains"
</div> -->
<div class="row">
    <div class="col-md-3">
        <div id="tree1" class="tree"></div>
    </div>
    <div class="col-md-9">
        <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>名称</th>
                    <th>SN</th>
                    <th>类型</th>
                    <th>链接地址</th>
                    <th>操作</th>
                </tr>
                </thead>

                <tbody>
                    <tr th:each="obj : ${datas}">
                        <td>${obj.id}</td>
                        <td>${obj.name}</td>
                        <td>${obj.sn}</td>
                        <td>
                            <div th:switch="${obj.type}" th:remove="tag">
                                <p th:case="1" th:remove="tag">导航菜单</p>
                                <p th:case="*" th:remove="tag">权限菜单</p>
                            </div>
                        </td>
                        <td>${obj.href}</td>
                        <td>
                            -
                        </td>
                    </tr>
                </tbody>
                <tfoot>
                </tfoot>
            </table>
        </div>
    </div>
</div>
</body>
</html>